# DynamicCRUD v4.1 - Theme System Plan

**Status:** Planning  
**Target:** Phase 3 of v4.0 roadmap  
**Estimated Time:** 2-3 weeks

## ğŸ¯ Objective

Create a complete theme system that allows users to customize the look and feel of their CMS without touching code. Think "WordPress themes" but simpler and more powerful.

## ğŸ“‹ Requirements

### Must Have
1. Theme interface for pluggable themes
2. ThemeManager for theme lifecycle
3. 3 pre-built themes (minimal, modern, classic)
4. Theme configuration (colors, fonts, layout)
5. Theme switching without data loss
6. Integration with FrontendRenderer

### Nice to Have
7. Theme customizer UI
8. Theme preview mode
9. Custom CSS injection
10. Theme marketplace foundation

## ğŸ—ï¸ Architecture

### 1. Theme Interface

```php
interface Theme
{
    public function getName(): string;
    public function getDescription(): string;
    public function getVersion(): string;
    public function getAuthor(): string;
    public function getScreenshot(): string;
    
    public function getConfig(): array;
    public function getTemplates(): array;
    public function getAssets(): array;
    
    public function render(string $template, array $data): string;
}
```

### 2. ThemeManager Class

```php
class ThemeManager
{
    private PDO $pdo;
    private string $themesDir;
    private ?Theme $activeTheme = null;
    
    public function __construct(PDO $pdo, string $themesDir);
    
    // Theme Management
    public function register(string $name, Theme $theme): void;
    public function getAvailable(): array;
    public function getActive(): ?Theme;
    public function activate(string $name): bool;
    public function deactivate(): bool;
    
    // Theme Info
    public function getThemeInfo(string $name): array;
    public function isInstalled(string $name): bool;
    
    // Rendering
    public function render(string $template, array $data): string;
    
    // Configuration
    public function getConfig(string $key = null): mixed;
    public function setConfig(string $key, mixed $value): bool;
}
```

### 3. Built-in Themes

#### MinimalTheme
- Clean, simple design
- Focus on content
- Fast loading
- Mobile-first
- Colors: White, Gray, Black
- Font: System fonts

#### ModernTheme
- Gradient backgrounds
- Card-based layout
- Smooth animations
- Dark mode support
- Colors: Purple (#667eea), Blue, White
- Font: Inter, SF Pro

#### ClassicTheme
- Traditional blog design
- Sidebar layout
- Serif fonts
- Warm colors
- Colors: Brown, Beige, White
- Font: Georgia, Times

### 4. Theme Configuration

```php
// themes/modern/config.php
return [
    'name' => 'Modern',
    'description' => 'Modern theme with gradients and animations',
    'version' => '1.0.0',
    'author' => 'DynamicCRUD',
    'screenshot' => 'screenshot.png',
    
    'colors' => [
        'primary' => '#667eea',
        'secondary' => '#764ba2',
        'background' => '#f5f7fa',
        'text' => '#333333',
        'link' => '#667eea'
    ],
    
    'fonts' => [
        'heading' => 'Inter, sans-serif',
        'body' => 'Inter, sans-serif'
    ],
    
    'layout' => [
        'container_width' => '1200px',
        'sidebar' => false,
        'header_style' => 'fixed'
    ],
    
    'features' => [
        'dark_mode' => true,
        'animations' => true,
        'breadcrumbs' => true,
        'social_share' => true
    ]
];
```

### 5. Theme Templates

```
themes/
â”œâ”€â”€ minimal/
â”‚   â”œâ”€â”€ config.php
â”‚   â”œâ”€â”€ screenshot.png
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ layout.php
â”‚   â”‚   â”œâ”€â”€ home.php
â”‚   â”‚   â”œâ”€â”€ single.php
â”‚   â”‚   â”œâ”€â”€ archive.php
â”‚   â”‚   â”œâ”€â”€ category.php
â”‚   â”‚   â”œâ”€â”€ tag.php
â”‚   â”‚   â”œâ”€â”€ search.php
â”‚   â”‚   â””â”€â”€ 404.php
â”‚   â””â”€â”€ assets/
â”‚       â”œâ”€â”€ style.css
â”‚       â””â”€â”€ script.js
â”œâ”€â”€ modern/
â”‚   â””â”€â”€ ...
â””â”€â”€ classic/
    â””â”€â”€ ...
```

## ğŸ“ Implementation Steps

### Step 1: Core Classes (Week 1)

**Files to Create:**
- `src/Theme/Theme.php` - Interface
- `src/Theme/ThemeManager.php` - Manager class
- `src/Theme/AbstractTheme.php` - Base class for themes

**Tasks:**
1. Create Theme interface
2. Implement ThemeManager with registration and activation
3. Create AbstractTheme base class
4. Add theme storage in database (`_themes` table)
5. Integration with FrontendRenderer

**Tests:**
- ThemeManagerTest.php (15 tests)
- Theme registration and activation
- Theme configuration management
- Database storage

### Step 2: Built-in Themes (Week 2)

**Files to Create:**
- `src/Theme/Themes/MinimalTheme.php`
- `src/Theme/Themes/ModernTheme.php`
- `src/Theme/Themes/ClassicTheme.php`
- `themes/minimal/` - Templates and assets
- `themes/modern/` - Templates and assets
- `themes/classic/` - Templates and assets

**Tasks:**
1. Implement MinimalTheme
2. Implement ModernTheme
3. Implement ClassicTheme
4. Create templates for each theme
5. Create CSS/JS assets for each theme

**Tests:**
- MinimalThemeTest.php (8 tests)
- ModernThemeTest.php (8 tests)
- ClassicThemeTest.php (8 tests)

### Step 3: Integration & Example (Week 2-3)

**Files to Create:**
- `examples/25-themes/` - Theme showcase example
- `examples/25-themes/setup.php`
- `examples/25-themes/index.php`
- `examples/25-themes/switch-theme.php`
- `examples/25-themes/README.md`

**Tasks:**
1. Integrate ThemeManager with FrontendRenderer
2. Create theme switcher UI
3. Create example with all 3 themes
4. Add theme preview functionality
5. Documentation

**Tests:**
- ThemeIntegrationTest.php (10 tests)

### Step 4: Documentation (Week 3)

**Files to Create:**
- `docs/THEMES.md` - Complete theme guide
- Update `README.md` with theme section
- Update `CHANGELOG.md` with v4.1

**Content:**
- Theme system overview
- Creating custom themes
- Theme configuration options
- Template variables
- Best practices
- Examples

## ğŸ§ª Testing Strategy

**Total Tests:** ~49 new tests

1. **ThemeManagerTest** (15 tests)
   - Theme registration
   - Theme activation/deactivation
   - Configuration management
   - Database storage
   - Error handling

2. **Theme Tests** (24 tests, 8 per theme)
   - Template rendering
   - Configuration loading
   - Asset generation
   - Color schemes
   - Layout options

3. **Integration Tests** (10 tests)
   - FrontendRenderer integration
   - Theme switching
   - Template inheritance
   - Asset loading
   - Performance

## ğŸ“Š Success Metrics

- âœ… 3 working themes
- âœ… Theme switching in <1 second
- âœ… 100% test coverage for theme system
- âœ… Complete documentation
- âœ… Working example with theme switcher
- âœ… No breaking changes to existing code

## ğŸ¨ Theme Features Comparison

| Feature | Minimal | Modern | Classic |
|---------|---------|--------|---------|
| Dark Mode | âŒ | âœ… | âŒ |
| Animations | âŒ | âœ… | âŒ |
| Sidebar | âŒ | âŒ | âœ… |
| Gradients | âŒ | âœ… | âŒ |
| Serif Fonts | âŒ | âŒ | âœ… |
| Card Layout | âœ… | âœ… | âŒ |
| Mobile First | âœ… | âœ… | âœ… |
| Load Time | <50ms | <100ms | <75ms |

## ğŸ”„ Integration Points

### FrontendRenderer
```php
// Before
$renderer = new FrontendRenderer($pdo);

// After
$themeManager = new ThemeManager($pdo, __DIR__ . '/themes');
$themeManager->activate('modern');
$renderer = new FrontendRenderer($pdo, 'blog', null, null, '', $themeManager);
```

### Theme Switching
```php
// Switch theme
$themeManager->activate('classic');

// Get active theme
$theme = $themeManager->getActive();
echo $theme->getName(); // "Classic"

// Render with theme
echo $renderer->renderHome(); // Uses Classic theme
```

## ğŸ“¦ Database Schema

```sql
CREATE TABLE _themes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    active BOOLEAN DEFAULT FALSE,
    config JSON,
    installed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT '{"display_name":"Themes","icon":"ğŸ¨"}';
```

## ğŸš€ Future Enhancements (v4.2+)

1. **Theme Customizer UI**
   - Live preview
   - Color picker
   - Font selector
   - Layout options

2. **Theme Marketplace**
   - Browse themes
   - One-click install
   - Theme ratings
   - Premium themes

3. **Theme Builder**
   - Visual theme creator
   - No-code customization
   - Export/import themes

4. **Advanced Features**
   - Child themes
   - Theme hooks
   - Custom widgets
   - Page builders

## ğŸ’¡ Design Decisions

### Why 3 Themes?
- Covers main use cases (minimal, modern, traditional)
- Demonstrates theme system capabilities
- Easy to maintain
- Good starting point for users

### Why File-based Templates?
- Simple to understand
- Easy to customize
- No compilation needed
- Fast rendering

### Why JSON Config?
- Easy to parse
- Flexible structure
- Human-readable
- Version control friendly

## ğŸ“‹ Checklist

### Week 1
- [ ] Create Theme interface
- [ ] Implement ThemeManager
- [ ] Create AbstractTheme
- [ ] Add database table
- [ ] Write 15 tests
- [ ] Integration with FrontendRenderer

### Week 2
- [ ] Implement MinimalTheme
- [ ] Implement ModernTheme
- [ ] Implement ClassicTheme
- [ ] Create templates (24 files)
- [ ] Create assets (CSS/JS)
- [ ] Write 24 tests

### Week 3
- [ ] Create example 25
- [ ] Theme switcher UI
- [ ] Write 10 integration tests
- [ ] Write documentation
- [ ] Update README
- [ ] Update CHANGELOG
- [ ] Final testing

## ğŸ¯ Definition of Done

- [ ] All 49 tests passing (100%)
- [ ] 3 themes fully functional
- [ ] Theme switching works
- [ ] Example 25 complete
- [ ] Documentation complete
- [ ] No breaking changes
- [ ] Code reviewed
- [ ] Performance tested
- [ ] Ready for commit

---

**Estimated Completion:** 2-3 weeks  
**Next Review:** After Week 1 completion
